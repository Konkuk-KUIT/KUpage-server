spring:
  profiles:
    active: local
    group:
      local: common, local-db, local-runtime
      prod: common, prod-db, prod-runtime

---

spring:
  config:
    activate:
      on-profile: common

  security:
    oauth2:
      client:
        registration:
          discord:
            client-id: ${DISCORD_CLIENT_ID}
            client-secret: ${DISCORD_CLIENT_SECRET}
            scope:
              - email
              - guilds.join
              - guilds.members.read
              - identify
            redirect-uri: ${DISCORD_REDIRECT_URI}
            authorization-grant-type: authorization_code
            client-authentication-method: client_secret_post
        provider:
          discord:
            authorization-uri: https://discord.com/oauth2/authorize
            token-uri: https://discord.com/api/oauth2/token
            user-info-uri: https://discord.com/api/users/@me
            user-name-attribute: id

  servlet:
    multipart:
      max-file-size: 120MB
      max-request-size: 400MB

discord:
  guild-id: ${DISCORD_GUILD_ID}
  bot-token: ${DISCORD_BOT_TOKEN}

cloud:
  aws:
    s3:
      bucket-name: ${AWS_S3_BUCKET_NAME}
    cloudfront:
      deploy-url: ${CLOUDFRONT_DEPLOY_URL}
    credentials:
      access-key: ${AWS_ACCESS_KEY_ID}
      secret-key: ${AWS_SECRET_ACCESS_KEY}
    region:
      static: ap-northeast-2
      auto: false
    stack:
      auto: false

secret:
  jwt:
    key: ${JWT_SECRET_KEY}
    access:
      expiration: 2592000000
    refresh:
      expiration: 2592000000

springdoc:
  default-consumes-media-type: application/json;charset=UTF-8
  default-produces-media-type: application/json;charset=UTF-8
  swagger-ui:
    enabled: true
    path: /swagger-ui
    disable-swagger-default-url: true
    display-request-duration: true
    operations-sorter: alpha
    tags-sorter: alpha
  enable-spring-security: false

const:
  current-batch: SIXTH
  first-round-result-time: 2025-12-02T12:00:00         # KST: 2025-12-02 21:00
  second-round-result-time: 2025-12-04T12:00:00        # KST: 2025-12-04 21:00

management:
  endpoints:
    web:
      exposure:
        include: health, metrics, prometheus, info
  endpoint:
    health:
      show-details: always
      show-components: always
  health:
    kafka:
      enabled: true

---

spring:
  config:
    activate:
      on-profile: local-db

  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: ${LOCAL_DB_URL}
    username: ${LOCAL_DB_USERNAME}
    password: ${LOCAL_DB_PASSWORD}
    hikari:
      data-source-properties:
        rewriteBatchedStatements: true

  sql:
    init:
      mode: never

  jpa:
    hibernate:
      ddl-auto: validate
    properties:
      hibernate:
        format_sql: true
        default_batch_fetch_size: 50
        jdbc:
          batch_size: 50
        order_inserts: true
        order_updates: true
    show-sql: true

  flyway:
    enabled: true
    locations: classpath:db/migration
    baseline-on-migrate: true              # 이미 스키마/데이터 있는 DB를 baseline 처리

---

spring:
  config:
    activate:
      on-profile: local-runtime

  kafka:
    bootstrap-servers: ${KAFKA_BOOTSTRAP_SERVERS:localhost:9094}
    admin:
      fail-fast: true                  # false => kafka 연결 안돼도 부팅 실패 안함
    listener:
      auto-startup: false               # false => @KafkaListener가 있어도 부팅 때 안 붙음
      missing-topics-fatal: false       # false => 토픽 없어도 부팅 실패 안 함

server:
  port: 9000

logging:
  level:
    com.kuit.kupage: DEBUG
    org.springframework.kafka: DEBUG
    org.apache.kafka: DEBUG

---

spring:
  config:
    activate:
      on-profile: prod-db

  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: ${PROD_DB_URL}
    username: ${PROD_DB_USERNAME}
    password: ${PROD_DB_PASSWORD}
    hikari:
      data-source-properties:
        rewriteBatchedStatements: true
  sql:
    init:
      mode: never
  jpa:
    hibernate:
      ddl-auto: validate
    properties:
      hibernate:
        format_sql: false
        default_batch_fetch_size: 50
        jdbc:
          batch_size: 50
        order_inserts: true
        order_updates: true
    show-sql: false

  flyway:
    enabled: true
    locations: classpath:db/migration
    baseline-on-migrate: true              # 이미 스키마/데이터 있는 DB를 baseline 처리

---

spring:
  config:
    activate:
      on-profile: prod-runtime

  kafka:
    bootstrap-servers: ${KAFKA_BOOTSTRAP_SERVERS}
    admin:
      fail-fast: false
    listener:
      auto-startup: true
      missing-topics-fatal: false

server:
  port: 8080

logging:
  level:
    com.kuit.kupage: INFO
